{"version":3,"sources":["../../../../../src/plugin/payload/views/login/index.tsx"],"sourcesContent":["import React from 'react'\nimport type { AdminViewServerProps, ServerProps } from 'payload'\nimport { RenderServerComponent } from '@payloadcms/ui/elements/RenderServerComponent'\nimport { redirect } from 'next/navigation'\nimport { Gutter } from '@payloadcms/ui'\nimport SignIn from '../../components/sign-in'\nimport Logo from '../../components/logo'\n\nexport default async function LoginView({\n  initPageResult,\n  params,\n  searchParams,\n  defaultAdminRole,\n}: AdminViewServerProps & { defaultAdminRole: string }) {\n  const { locale, permissions, req } = initPageResult\n  const {\n    i18n,\n    payload: { config },\n    payload,\n    user,\n  } = req\n\n  const {\n    admin: { components: { afterLogin, beforeLogin, graphics } = {}, user: userSlug },\n    routes: { admin },\n  } = config\n\n  const adminCount = await req.payload.count({\n    collection: userSlug,\n    where: {\n      role: {\n        equals: defaultAdminRole ?? 'admin',\n      },\n    },\n  })\n\n  // Filter out the first component from afterLogin array or set to undefined if not more than 1\n  const filteredAfterLogin =\n    Array.isArray(afterLogin) && afterLogin.length > 1 ? afterLogin.slice(1) : undefined\n\n  if (adminCount.totalDocs === 0) {\n    redirect(`${admin}/create-first-admin`)\n  }\n\n  return (\n    <Gutter className=\"mt-40\">\n      {RenderServerComponent({\n        Component: graphics?.Logo,\n        Fallback: () => <Logo />,\n        importMap: payload.importMap,\n        serverProps: {\n          i18n,\n          locale,\n          params,\n          payload,\n          permissions,\n          searchParams,\n          user: user ?? undefined,\n        } satisfies ServerProps,\n      })}\n      {RenderServerComponent({\n        Component: beforeLogin,\n        importMap: payload.importMap,\n        serverProps: {\n          i18n,\n          locale,\n          params,\n          payload,\n          permissions,\n          searchParams,\n          user: user ?? undefined,\n        } satisfies ServerProps,\n      })}\n      <div className=\"flex flex-col items-center justify-center w-full\">\n        <SignIn admin={true} />\n      </div>\n      {RenderServerComponent({\n        Component: filteredAfterLogin,\n        importMap: payload.importMap,\n        serverProps: {\n          i18n,\n          locale,\n          params,\n          payload,\n          permissions,\n          searchParams,\n          user: user ?? undefined,\n        } satisfies ServerProps,\n      })}\n    </Gutter>\n  )\n}\n"],"names":["React","RenderServerComponent","redirect","Gutter","SignIn","Logo","LoginView","initPageResult","params","searchParams","defaultAdminRole","locale","permissions","req","i18n","payload","config","user","admin","components","afterLogin","beforeLogin","graphics","userSlug","routes","adminCount","count","collection","where","role","equals","filteredAfterLogin","Array","isArray","length","slice","undefined","totalDocs","className","Component","Fallback","importMap","serverProps","div"],"mappings":";AAAA,OAAOA,WAAW,QAAO;AAEzB,SAASC,qBAAqB,QAAQ,gDAA+C;AACrF,SAASC,QAAQ,QAAQ,kBAAiB;AAC1C,SAASC,MAAM,QAAQ,iBAAgB;AACvC,OAAOC,YAAY,2BAA0B;AAC7C,OAAOC,UAAU,wBAAuB;AAExC,eAAe,eAAeC,UAAU,EACtCC,cAAc,EACdC,MAAM,EACNC,YAAY,EACZC,gBAAgB,EACoC;IACpD,MAAM,EAAEC,MAAM,EAAEC,WAAW,EAAEC,GAAG,EAAE,GAAGN;IACrC,MAAM,EACJO,IAAI,EACJC,SAAS,EAAEC,MAAM,EAAE,EACnBD,OAAO,EACPE,IAAI,EACL,GAAGJ;IAEJ,MAAM,EACJK,OAAO,EAAEC,YAAY,EAAEC,UAAU,EAAEC,WAAW,EAAEC,QAAQ,EAAE,GAAG,CAAC,CAAC,EAAEL,MAAMM,QAAQ,EAAE,EACjFC,QAAQ,EAAEN,KAAK,EAAE,EAClB,GAAGF;IAEJ,MAAMS,aAAa,MAAMZ,IAAIE,OAAO,CAACW,KAAK,CAAC;QACzCC,YAAYJ;QACZK,OAAO;YACLC,MAAM;gBACJC,QAAQpB,oBAAoB;YAC9B;QACF;IACF;IAEA,8FAA8F;IAC9F,MAAMqB,qBACJC,MAAMC,OAAO,CAACb,eAAeA,WAAWc,MAAM,GAAG,IAAId,WAAWe,KAAK,CAAC,KAAKC;IAE7E,IAAIX,WAAWY,SAAS,KAAK,GAAG;QAC9BnC,SAAS,GAAGgB,MAAM,mBAAmB,CAAC;IACxC;IAEA,qBACE,MAACf;QAAOmC,WAAU;;YACfrC,sBAAsB;gBACrBsC,WAAWjB,UAAUjB;gBACrBmC,UAAU,kBAAM,KAACnC;gBACjBoC,WAAW1B,QAAQ0B,SAAS;gBAC5BC,aAAa;oBACX5B;oBACAH;oBACAH;oBACAO;oBACAH;oBACAH;oBACAQ,MAAMA,QAAQmB;gBAChB;YACF;YACCnC,sBAAsB;gBACrBsC,WAAWlB;gBACXoB,WAAW1B,QAAQ0B,SAAS;gBAC5BC,aAAa;oBACX5B;oBACAH;oBACAH;oBACAO;oBACAH;oBACAH;oBACAQ,MAAMA,QAAQmB;gBAChB;YACF;0BACA,KAACO;gBAAIL,WAAU;0BACb,cAAA,KAAClC;oBAAOc,OAAO;;;YAEhBjB,sBAAsB;gBACrBsC,WAAWR;gBACXU,WAAW1B,QAAQ0B,SAAS;gBAC5BC,aAAa;oBACX5B;oBACAH;oBACAH;oBACAO;oBACAH;oBACAH;oBACAQ,MAAMA,QAAQmB;gBAChB;YACF;;;AAGN"}