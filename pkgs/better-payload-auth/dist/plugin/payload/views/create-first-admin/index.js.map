{"version":3,"sources":["../../../../../src/plugin/payload/views/create-first-admin/index.tsx"],"sourcesContent":["import React from 'react'\nimport type { AdminViewServerProps, ServerProps } from 'payload'\nimport { RenderServerComponent } from '@payloadcms/ui/elements/RenderServerComponent'\nimport { redirect } from 'next/navigation'\nimport { Gutter } from '@payloadcms/ui'\nimport { SignUp } from '../../components/sign-up'\nimport Logo from '../../components/logo'\n\nexport default async function CreateFirstAdmin({\n  initPageResult,\n  params,\n  searchParams,\n  defaultAdminRole,\n}: AdminViewServerProps & { defaultAdminRole: string }) {\n  const { locale, permissions, req } = initPageResult\n  const {\n    i18n,\n    payload: { config },\n    payload,\n    user,\n  } = req\n\n  const {\n    admin: { components: { afterLogin, beforeLogin, graphics } = {}, user: userSlug },\n    routes: { admin, api },\n  } = config\n\n  const adminCount = await req.payload.count({\n    collection: userSlug,\n    where: {\n      role: {\n        equals: defaultAdminRole ?? 'admin',\n      },\n    },\n  })\n\n  if (adminCount.totalDocs > 0) {\n    redirect(admin)\n  }\n\n  // const addRoleAction = async (userId: string) => {\n  //   'use server'\n  //   await payload.update({\n  //     collection: userSlug,\n  //     id: userId,\n  //     data: {\n  //       role: defaultAdminRole ?? 'admin',\n  //     },\n  //   })\n  // }\n\n  // Filter out the first component from afterLogin array or set to undefined if not more than 1\n  const filteredAfterLogin =\n    Array.isArray(afterLogin) && afterLogin.length > 1 ? afterLogin.slice(1) : undefined\n\n  return (\n    <Gutter className=\"mt-40\">\n      <div\n        style={{\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center',\n          justifyContent: 'center',\n          width: '100%',\n        }}\n      >\n        <div\n          style={{\n            display: 'flex',\n            justifyContent: 'center',\n            width: '100%',\n            marginBottom: '1.5rem',\n          }}\n        >\n          {RenderServerComponent({\n            Component: graphics?.Logo,\n            Fallback: () => <Logo />,\n            importMap: payload.importMap,\n            serverProps: {\n              i18n,\n              locale,\n              params,\n              payload,\n              permissions,\n              searchParams,\n              user: user ?? undefined,\n            } satisfies ServerProps,\n          })}\n        </div>\n        {RenderServerComponent({\n          Component: beforeLogin,\n          importMap: payload.importMap,\n          serverProps: {\n            i18n,\n            locale,\n            params,\n            payload,\n            permissions,\n            searchParams,\n            user: user ?? undefined,\n          } satisfies ServerProps,\n        })}\n        <div\n          style={{\n            display: 'flex',\n            flexDirection: 'column',\n            alignItems: 'center',\n            justifyContent: 'center',\n            width: '100%',\n          }}\n        >\n          <SignUp\n            admin={true}\n            apiRoute={api}\n            userSlug={userSlug}\n            defaultAdminRole={defaultAdminRole}\n          />\n        </div>\n        {RenderServerComponent({\n          Component: filteredAfterLogin,\n          importMap: payload.importMap,\n          serverProps: {\n            i18n,\n            locale,\n            params,\n            payload,\n            permissions,\n            searchParams,\n            user: user ?? undefined,\n          } satisfies ServerProps,\n        })}\n      </div>\n    </Gutter>\n  )\n}\n"],"names":["React","RenderServerComponent","redirect","Gutter","SignUp","Logo","CreateFirstAdmin","initPageResult","params","searchParams","defaultAdminRole","locale","permissions","req","i18n","payload","config","user","admin","components","afterLogin","beforeLogin","graphics","userSlug","routes","api","adminCount","count","collection","where","role","equals","totalDocs","filteredAfterLogin","Array","isArray","length","slice","undefined","className","div","style","display","flexDirection","alignItems","justifyContent","width","marginBottom","Component","Fallback","importMap","serverProps","apiRoute"],"mappings":";AAAA,OAAOA,WAAW,QAAO;AAEzB,SAASC,qBAAqB,QAAQ,gDAA+C;AACrF,SAASC,QAAQ,QAAQ,kBAAiB;AAC1C,SAASC,MAAM,QAAQ,iBAAgB;AACvC,SAASC,MAAM,QAAQ,2BAA0B;AACjD,OAAOC,UAAU,wBAAuB;AAExC,eAAe,eAAeC,iBAAiB,EAC7CC,cAAc,EACdC,MAAM,EACNC,YAAY,EACZC,gBAAgB,EACoC;IACpD,MAAM,EAAEC,MAAM,EAAEC,WAAW,EAAEC,GAAG,EAAE,GAAGN;IACrC,MAAM,EACJO,IAAI,EACJC,SAAS,EAAEC,MAAM,EAAE,EACnBD,OAAO,EACPE,IAAI,EACL,GAAGJ;IAEJ,MAAM,EACJK,OAAO,EAAEC,YAAY,EAAEC,UAAU,EAAEC,WAAW,EAAEC,QAAQ,EAAE,GAAG,CAAC,CAAC,EAAEL,MAAMM,QAAQ,EAAE,EACjFC,QAAQ,EAAEN,KAAK,EAAEO,GAAG,EAAE,EACvB,GAAGT;IAEJ,MAAMU,aAAa,MAAMb,IAAIE,OAAO,CAACY,KAAK,CAAC;QACzCC,YAAYL;QACZM,OAAO;YACLC,MAAM;gBACJC,QAAQrB,oBAAoB;YAC9B;QACF;IACF;IAEA,IAAIgB,WAAWM,SAAS,GAAG,GAAG;QAC5B9B,SAASgB;IACX;IAEA,oDAAoD;IACpD,iBAAiB;IACjB,2BAA2B;IAC3B,4BAA4B;IAC5B,kBAAkB;IAClB,cAAc;IACd,2CAA2C;IAC3C,SAAS;IACT,OAAO;IACP,IAAI;IAEJ,8FAA8F;IAC9F,MAAMe,qBACJC,MAAMC,OAAO,CAACf,eAAeA,WAAWgB,MAAM,GAAG,IAAIhB,WAAWiB,KAAK,CAAC,KAAKC;IAE7E,qBACE,KAACnC;QAAOoC,WAAU;kBAChB,cAAA,MAACC;YACCC,OAAO;gBACLC,SAAS;gBACTC,eAAe;gBACfC,YAAY;gBACZC,gBAAgB;gBAChBC,OAAO;YACT;;8BAEA,KAACN;oBACCC,OAAO;wBACLC,SAAS;wBACTG,gBAAgB;wBAChBC,OAAO;wBACPC,cAAc;oBAChB;8BAEC9C,sBAAsB;wBACrB+C,WAAW1B,UAAUjB;wBACrB4C,UAAU,kBAAM,KAAC5C;wBACjB6C,WAAWnC,QAAQmC,SAAS;wBAC5BC,aAAa;4BACXrC;4BACAH;4BACAH;4BACAO;4BACAH;4BACAH;4BACAQ,MAAMA,QAAQqB;wBAChB;oBACF;;gBAEDrC,sBAAsB;oBACrB+C,WAAW3B;oBACX6B,WAAWnC,QAAQmC,SAAS;oBAC5BC,aAAa;wBACXrC;wBACAH;wBACAH;wBACAO;wBACAH;wBACAH;wBACAQ,MAAMA,QAAQqB;oBAChB;gBACF;8BACA,KAACE;oBACCC,OAAO;wBACLC,SAAS;wBACTC,eAAe;wBACfC,YAAY;wBACZC,gBAAgB;wBAChBC,OAAO;oBACT;8BAEA,cAAA,KAAC1C;wBACCc,OAAO;wBACPkC,UAAU3B;wBACVF,UAAUA;wBACVb,kBAAkBA;;;gBAGrBT,sBAAsB;oBACrB+C,WAAWf;oBACXiB,WAAWnC,QAAQmC,SAAS;oBAC5BC,aAAa;wBACXrC;wBACAH;wBACAH;wBACAO;wBACAH;wBACAH;wBACAQ,MAAMA,QAAQqB;oBAChB;gBACF;;;;AAIR"}